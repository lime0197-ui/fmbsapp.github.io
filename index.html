<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barber Pro Tracker - Edit/Delete</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --success: #27ae60; --danger: #e74c3c; --warning: #f39c12; --light: #ecf0f1; --edit: #3498db; }
        body { font-family: 'Helvetica Neue', sans-serif; background-color: #f0f2f5; padding: 15px; }
        .container { max-width: 650px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
        
        .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn { padding: 15px; border-radius: 8px; font-size: 16px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .btn-save { background-color: var(--success); }
        .btn-holiday { background-color: var(--danger); }
        .btn-export { background-color: var(--primary); width: 100%; margin-top: 20px; }
        
        .summary-card { background: var(--primary); color: white; padding: 20px; border-radius: 12px; margin: 25px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .summary-item { text-align: center; }
        .summary-item.full { grid-column: span 2; border-bottom: 1px solid #ffffff33; padding-bottom: 10px; }

        .table-header { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .btn-sort { background: var(--light); color: var(--primary); border: 1px solid #ccc; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .actions { display: flex; gap: 5px; }
        .btn-action { padding: 5px 8px; border-radius: 4px; border: none; color: white; cursor: pointer; font-size: 12px; }
        .btn-edit { background-color: var(--edit); }
        .btn-del { background-color: var(--danger); }
        .status-holiday { color: var(--danger); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="formTitle">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏°</h2>
    
    <input type="hidden" id="editIndex" value="-1">
    
    <div class="input-group">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" id="date">
    </div>

    <div id="incomeFields">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</label><input type="number" id="cash" placeholder="0"></div>
            <div class="input-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô</label><input type="number" id="transfer" placeholder="0"></div>
        </div>
        <div class="input-group"><label>‡∏ó‡∏¥‡∏õ</label><input type="number" id="tip" placeholder="0"></div>
    </div>
    
    <div class="button-group" id="normalButtons">
        <button class="btn btn-save" onclick="saveData(false)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î</button>
        <button class="btn btn-holiday" onclick="saveData(true)">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô</button>
    </div>
    
    <div id="editButtons" style="display: none; gap: 10px; margin-top: 10px;">
        <button class="btn btn-save" style="flex: 2;" onclick="updateData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn btn-holiday" style="flex: 1; background-color: #7f8c8d;" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>

    <div class="summary-card">
        <div class="summary-item full"><span>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span><strong id="totalRevenue">0</strong></div>
        <div class="summary-item"><span>‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span><strong id="totalCash">0</strong></div>
        <div class="summary-item"><span>‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô</span><strong id="totalTransfer">0</strong></div>
    </div>

    <button class="btn btn-export" onclick="exportToExcel()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)</button>

    <div class="table-header">
        <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
        <button class="btn-sort" onclick="toggleSort()">üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á: <span id="sortText">‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤</span></button>
    </div>
    <table id="recordTable">
        <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏¢‡∏≠‡∏î/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏ó‡∏¥‡∏õ</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<script>
    document.getElementById('date').valueAsDate = new Date();
    let isNewestFirst = true;

    function getRecords() {
        return JSON.parse(localStorage.getItem('barberFinalRecords')) || [];
    }

    function saveData(isHoliday) {
        const date = document.getElementById('date').value;
        const cash = isHoliday ? 0 : (parseFloat(document.getElementById('cash').value) || 0);
        const transfer = isHoliday ? 0 : (parseFloat(document.getElementById('transfer').value) || 0);
        const tip = isHoliday ? 0 : (parseFloat(document.getElementById('tip').value) || 0);

        let records = getRecords();
        records.push({ id: Date.now(), date, cash, transfer, tip, isHoliday });
        localStorage.setItem('barberFinalRecords', JSON.stringify(records));
        
        clearInputs();
        renderData();
    }

    function deleteRecord(id) {
        if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            let records = getRecords();
            records = records.filter(r => r.id !== id);
            localStorage.setItem('barberFinalRecords', JSON.stringify(records));
            renderData();
        }
    }

    function editRecord(id) {
        const records = getRecords();
        const record = records.find(r => r.id === id);
        
        document.getElementById('date').value = record.date;
        document.getElementById('cash').value = record.cash;
        document.getElementById('transfer').value = record.transfer;
        document.getElementById('tip').value = record.tip;
        document.getElementById('editIndex').value = id;

        document.getElementById('formTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('normalButtons').style.display = 'none';
        document.getElementById('editButtons').style.display = 'flex';
        window.scrollTo(0, 0);
    }

    function updateData() {
        const id = parseInt(document.getElementById('editIndex').value);
        let records = getRecords();
        const index = records.findIndex(r => r.id === id);
        
        records[index] = {
            id: id,
            date: document.getElementById('date').value,
            cash: parseFloat(document.getElementById('cash').value) || 0,
            transfer: parseFloat(document.getElementById('transfer').value) || 0,
            tip: parseFloat(document.getElementById('tip').value) || 0,
            isHoliday: false
        };

        localStorage.setItem('barberFinalRecords', JSON.stringify(records));
        cancelEdit();
        renderData();
    }

    function cancelEdit() {
        document.getElementById('editIndex').value = "-1";
        document.getElementById('formTitle').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏°";
        document.getElementById('normalButtons').style.display = 'grid';
        document.getElementById('editButtons').style.display = 'none';
        clearInputs();
    }

    function clearInputs() {
        document.getElementById('cash').value = '';
        document.getElementById('transfer').value = '';
        document.getElementById('tip').value = '';
        document.getElementById('date').valueAsDate = new Date();
    }

    function toggleSort() {
        isNewestFirst = !isNewestFirst;
        document.getElementById('sortText').innerText = isNewestFirst ? "‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤" : "‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡∏°‡πà";
        renderData();
    }

    function renderData() {
        const records = getRecords();
        const tbody = document.querySelector('#recordTable tbody');
        let mTotal = 0, mCash = 0, mTransfer = 0;
        const now = new Date();

        records.sort((a, b) => isNewestFirst ? new Date(b.date) - new Date(a.date) : new Date(a.date) - new Date(b.date));

        tbody.innerHTML = '';
        records.forEach(item => {
            const d = new Date(item.date);
            if (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
                mCash += item.cash; mTransfer += item.transfer; mTotal += (item.cash + item.transfer);
            }

            const statusText = item.isHoliday ? '<span class="status-holiday">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>' : (item.cash + item.transfer).toLocaleString();
            tbody.innerHTML += `<tr>
                <td>${item.date}</td>
                <td>${statusText}</td>
                <td>${item.tip.toLocaleString()}</td>
                <td>
                    <div class="actions">
                        <button class="btn-action btn-edit" onclick="editRecord(${item.id})">‡πÅ‡∏Å‡πâ</button>
                        <button class="btn-action btn-del" onclick="deleteRecord(${item.id})">‡∏•‡∏ö</button>
                    </div>
                </td>
            </tr>`;
        });

        document.getElementById('totalRevenue').innerText = mTotal.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
        document.getElementById('totalCash').innerText = mCash.toLocaleString();
        document.getElementById('totalTransfer').innerText = mTransfer.toLocaleString();
    }

    function exportToExcel() {
        const records = getRecords();
        const now = new Date();
        const monthlyData = records
            .filter(r => new Date(r.date).getMonth() === now.getMonth())
            .map(r => ({
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': r.date,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': r.isHoliday ? '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô',
                '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î': r.cash,
                '‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô': r.transfer,
                '‡∏ó‡∏¥‡∏õ': r.tip,
                '‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ': r.cash + r.transfer
            }));

        const ws = XLSX.utils.json_to_sheet(monthlyData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");
        XLSX.writeFile(wb, `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_Barber_${now.getMonth()+1}_${now.getFullYear()}.xlsx`);
    }

    renderData();
</script>

</body>
</html>

<script>
    document.getElementById('date').valueAsDate = new Date();
    let isNewestFirst = true;

    function getRecords() {
        return JSON.parse(localStorage.getItem('barberFinalRecords')) || [];
    }

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà ID ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    function saveData(isHoliday) {
        const date = document.getElementById('date').value;
        const cash = isHoliday ? 0 : (parseFloat(document.getElementById('cash').value) || 0);
        const transfer = isHoliday ? 0 : (parseFloat(document.getElementById('transfer').value) || 0);
        const tip = isHoliday ? 0 : (parseFloat(document.getElementById('tip').value) || 0);

        let records = getRecords();
        // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
        const newRecord = { id: Date.now(), date, cash, transfer, tip, isHoliday };
        records.push(newRecord);
        localStorage.setItem('barberFinalRecords', JSON.stringify(records));
        
        clearInputs();
        renderData();
    }

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö: ‡πÉ‡∏ä‡πâ ID ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≠‡∏Å
    function deleteRecord(id) {
        if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            let records = getRecords();
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ ID ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            const updatedRecords = records.filter(r => r.id !== id);
            localStorage.setItem('barberFinalRecords', JSON.stringify(updatedRecords));
            renderData();
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° (Edit, Update, Render...)
    function editRecord(id) {
        const records = getRecords();
        const record = records.find(r => r.id === id);
        if(!record) return;

        document.getElementById('date').value = record.date;
        document.getElementById('cash').value = record.cash;
        document.getElementById('transfer').value = record.transfer;
        document.getElementById('tip').value = record.tip;
        document.getElementById('editIndex').value = id;

        document.getElementById('formTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('normalButtons').style.display = 'none';
        document.getElementById('editButtons').style.display = 'flex';
        window.scrollTo(0, 0);
    }

    function updateData() {
        const id = parseInt(document.getElementById('editIndex').value);
        let records = getRecords();
        const index = records.findIndex(r => r.id === id);
        
        if (index !== -1) {
            records[index] = {
                id: id,
                date: document.getElementById('date').value,
                cash: parseFloat(document.getElementById('cash').value) || 0,
                transfer: parseFloat(document.getElementById('transfer').value) || 0,
                tip: parseFloat(document.getElementById('tip').value) || 0,
                isHoliday: false
            };
            localStorage.setItem('barberFinalRecords', JSON.stringify(records));
        }
        cancelEdit();
        renderData();
    }

    function cancelEdit() {
        document.getElementById('editIndex').value = "-1";
        document.getElementById('formTitle').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏°";
        document.getElementById('normalButtons').style.display = 'grid';
        document.getElementById('editButtons').style.display = 'none';
        clearInputs();
    }

    function clearInputs() {
        document.getElementById('cash').value = '';
        document.getElementById('transfer').value = '';
        document.getElementById('tip').value = '';
        document.getElementById('date').valueAsDate = new Date();
    }

    function toggleSort() {
        isNewestFirst = !isNewestFirst;
        document.getElementById('sortText').innerText = isNewestFirst ? "‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤" : "‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡∏°‡πà";
        renderData();
    }

    function renderData() {
        const records = getRecords();
        const tbody = document.querySelector('#recordTable tbody');
        let mTotal = 0, mCash = 0, mTransfer = 0;
        const now = new Date();

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const sortedRecords = [...records].sort((a, b) => 
            isNewestFirst ? new Date(b.date) - new Date(a.date) : new Date(a.date) - new Date(b.date)
        );

        tbody.innerHTML = '';
        sortedRecords.forEach(item => {
            const d = new Date(item.date);
            if (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
                mCash += item.cash; 
                mTransfer += item.transfer; 
                mTotal += (item.cash + item.transfer);
            }

            // ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ID ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö‡πÑ‡∏î‡πâ
            const itemId = item.id || 0; 

            const statusText = item.isHoliday ? '<span class="status-holiday">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>' : (item.cash + item.transfer).toLocaleString();
            tbody.innerHTML += `<tr>
                <td>${item.date}</td>
                <td>${statusText}</td>
                <td>${item.tip.toLocaleString()}</td>
                <td>
                    <div class="actions">
                        <button class="btn-action btn-edit" onclick="editRecord(${itemId})">‡πÅ‡∏Å‡πâ</button>
                        <button class="btn-action btn-del" onclick="deleteRecord(${itemId})">‡∏•‡∏ö</button>
                    </div>
                </td>
            </tr>`;
        });

        document.getElementById('totalRevenue').innerText = mTotal.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
        document.getElementById('totalCash').innerText = mCash.toLocaleString();
        document.getElementById('totalTransfer').innerText = mTransfer.toLocaleString();
    }

    function exportToExcel() {
        const records = getRecords();
        const now = new Date();
        const monthlyData = records
            .filter(r => new Date(r.date).getMonth() === now.getMonth())
            .map(r => ({
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': r.date,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': r.isHoliday ? '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô',
                '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î': r.cash,
                '‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô': r.transfer,
                '‡∏ó‡∏¥‡∏õ': r.tip,
                '‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ': r.cash + r.transfer
            }));

        const ws = XLSX.utils.json_to_sheet(monthlyData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");
        XLSX.writeFile(wb, `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_Barber_${now.getMonth()+1}_${now.getFullYear()}.xlsx`);
    }

    renderData();
</script>
